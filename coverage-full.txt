node.exe : npm warn Unknown user config "msvs_version". This will stop working 
in the next major version of npm.
At C:\nvm4w\nodejs\npx.ps1:16 char:5
+     & "$basedir/node$exe"  "$basedir/node_modules/npm/bin/npx-cli.js" ...
+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : NotSpecified: (npm warn Unknow...version of npm. 
   :String) [], RemoteException
    + FullyQualifiedErrorId : NativeCommandError
 
npm warn Unknown user config "msvsVersion". This will stop working in the next 
major version of npm.

[7m[1m[36m RUN [39m[22m[27m [36mv1.6.1[39m [90mC:/Users/monag/_Projects/starspace/nabu[39m
[2m      Coverage enabled with [22m[33mv8[39m

 [32mΓ£ô[39m tests/unit/discord-callback-extended.test.ts [2m ([22m[2m19 tests[22m[2m)[22m[90m 90[2mms[22m[39m
 [32mΓ£ô[39m tests/unit/github-callback-coverage.test.ts [2m ([22m[2m19 tests[22m[2m)[22m[90m 97[2mms[22m[39m
 [32mΓ£ô[39m tests/unit/chat-history.test.ts [2m ([22m[2m44 tests[22m[2m)[22m[90m 25[2mms[22m[39m
[90mstderr[2m | tests/unit/ai-keys-api-extended.test.ts[2m > [22m[2mAI 
Keys API[2m > [22m[2mPOST /api/admin/ai-keys[2m > [22m[2mshould return 
400 when required fields are missing[22m[39m
Failed to create AI key: HttpError { status: [33m400[39m, body: { message: 
[32m'Missing required fields'[39m } }

[90mstderr[2m | tests/unit/ai-keys-api-extended.test.ts[2m > [22m[2mAI 
Keys API[2m > [22m[2mPOST /api/admin/ai-keys[2m > [22m[2mshould return 
500 when KV is not available[22m[39m
Failed to create AI key: HttpError {
  status: [33m500[39m,
  body: { message: [32m'KV storage not available'[39m }
}

[90mstderr[2m | tests/unit/ai-keys-api-extended.test.ts[2m > [22m[2mAI 
Keys API[2m > [22m[2mPUT /api/admin/ai-keys/[id][2m > [22m[2mshould 
return 400 when name is missing[22m[39m
Failed to update AI key: HttpError { status: [33m400[39m, body: { message: 
[32m'Missing required fields'[39m } }

[90mstderr[2m | tests/unit/ai-keys-api-extended.test.ts[2m > [22m[2mAI 
Keys API[2m > [22m[2mPUT /api/admin/ai-keys/[id][2m > [22m[2mshould 
return 500 when KV is not available[22m[39m
Failed to update AI key: HttpError {
  status: [33m500[39m,
  body: { message: [32m'KV storage not available'[39m }
}

[90mstderr[2m | tests/unit/ai-keys-api-extended.test.ts[2m > [22m[2mAI 
Keys API[2m > [22m[2mPUT /api/admin/ai-keys/[id][2m > [22m[2mshould 
return 404 when key not found[22m[39m
Failed to update AI key: HttpError { status: [33m404[39m, body: { message: 
[32m'Key not found'[39m } }

[90mstderr[2m | tests/unit/ai-keys-api-extended.test.ts[2m > [22m[2mAI 
Keys API[2m > [22m[2mDELETE /api/admin/ai-keys/[id][2m > [22m[2mshould 
return 500 when KV is not available[22m[39m
Failed to delete AI key: HttpError {
  status: [33m500[39m,
  body: { message: [32m'KV storage not available'[39m }
}

[90mstderr[2m | tests/unit/ai-keys-api-extended.test.ts[2m > [22m[2mAI 
Keys API[2m > [22m[2mPATCH /api/admin/ai-keys/[id][2m > [22m[2mshould 
return 500 when KV is not available[22m[39m
Failed to toggle AI key: HttpError {
  status: [33m500[39m,
  body: { message: [32m'KV storage not available'[39m }
}

[90mstderr[2m | tests/unit/ai-keys-api-extended.test.ts[2m > [22m[2mAI 
Keys API[2m > [22m[2mPATCH /api/admin/ai-keys/[id][2m > [22m[2mshould 
return 404 when key not found[22m[39m
Failed to toggle AI key: HttpError { status: [33m404[39m, body: { message: 
[32m'Key not found'[39m } }

 [32mΓ£ô[39m tests/unit/ai-keys-api-extended.test.ts [2m ([22m[2m30 tests[22m[2m)[22m[90m 117[2mms[22m[39m
 [32mΓ£ô[39m src/lib/components/CommandPalette.test.ts [2m ([22m[2m35 tests[22m[2m)[22m[33m 822[2mms[22m[39m
 [32mΓ£ô[39m tests/unit/cms-content-types-management.test.ts [2m ([22m[2m29 tests[22m[2m)[22m[90m 206[2mms[22m[39m
[90mstderr[2m | tests/unit/chat-interface.test.ts[2m > 
[22m[2mChatInterface Component[2m > [22m[2mUnified Chat Interface[2m > 
[22m[2mshould send message when user submits[22m[39m
Send message error: TypeError: Cannot read properties of undefined (reading 
'ok')
    at HTMLButtonElement.sendMessage [90m(C:\Users\monag\_Projects\starspace\n
abu\[39msrc\lib\components\ChatInterface.svelte:153:18[90m)[39m

[90mstderr[2m | tests/unit/chat-interface.test.ts[2m > 
[22m[2mChatInterface Component[2m > [22m[2mUnified Chat Interface[2m > 
[22m[2mshould send message on Enter key (without Shift)[22m[39m
Send message error: TypeError: Cannot read properties of undefined (reading 
'ok')
    at sendMessage [90m(C:\Users\monag\_Projects\starspace\nabu\[39msrc\lib\c
omponents\ChatInterface.svelte:153:18[90m)[39m

 [32mΓ£ô[39m tests/unit/chat-interface.test.ts [2m ([22m[2m31 tests[22m[2m)[22m[33m 640[2mms[22m[39m
 [32mΓ£ô[39m tests/unit/cms-api.test.ts [2m ([22m[2m16 tests[22m[2m)[22m[90m 119[2mms[22m[39m
 [32mΓ£ô[39m tests/unit/cms-service.test.ts [2m ([22m[2m22 tests[22m[2m)[22m[90m 89[2mms[22m[39m
[90mstderr[2m | tests/unit/github-oauth-flow.test.ts[2m > [22m[2mGitHub 
Auth API[2m > [22m[2mGET /api/auth/github/callback[2m > [22m[2mshould 
redirect to login when OAuth not configured[22m[39m
GitHub OAuth not configured - missing clientId or clientSecret

[90mstderr[2m | tests/unit/github-oauth-flow.test.ts[2m > [22m[2mGitHub 
Auth API[2m > [22m[2mGET /api/auth/github/callback[2m > [22m[2mshould 
handle token exchange failure[22m[39m
Failed to exchange code for token: [33m400[39m Bad Request

[90mstderr[2m | tests/unit/github-oauth-flow.test.ts[2m > [22m[2mGitHub 
Auth API[2m > [22m[2mGET /api/auth/github/callback[2m > [22m[2mshould 
handle missing access token in response[22m[39m
No access token in response: { error: [32m'no token'[39m }

[90mstderr[2m | tests/unit/github-oauth-flow.test.ts[2m > [22m[2mGitHub 
Auth API[2m > [22m[2mGET /api/auth/github/callback[2m > [22m[2mshould 
handle user fetch failure[22m[39m
Failed to fetch user info: [33m401[39m Unauthorized

[90mstdout[2m | tests/unit/github-oauth-flow.test.ts[2m > [22m[2mGitHub Auth API[2m > [22m[2mGET /api/auth/github/callback[2m > [22m[2mshould complete OAuth flow and set session cookie[22m[39m
[Auth] Owner check by ID: githubUser.id=12345, appOwnerId=12345, match=true

[90mstdout[2m | tests/unit/github-oauth-flow.test.ts[2m > [22m[2mGitHub Auth API[2m > [22m[2mGET /api/auth/github/callback[2m > [22m[2mshould redirect non-owner to home[22m[39m
[Auth] Owner check by ID: githubUser.id=12345, appOwnerId=99999, match=false

[90mstderr[2m | tests/unit/github-oauth-flow.test.ts[2m > [22m[2mGitHub 
Auth API[2m > [22m[2mGET /api/auth/github/callback[2m > [22m[2mshould 
store user in database when available[22m[39m
[Auth] No owner ID or username configured - isOwner will be false
GITHUB_OWNER_ID not set - all users will have isOwner=false. Set 
GITHUB_OWNER_ID in wrangler.toml to enable admin access.

[90mstderr[2m | tests/unit/github-oauth-flow.test.ts[2m > [22m[2mGitHub 
Auth API[2m > [22m[2mGET /api/auth/github/callback[2m > [22m[2mshould 
update existing user in database[22m[39m
[Auth] No owner ID or username configured - isOwner will be false
GITHUB_OWNER_ID not set - all users will have isOwner=false. Set 
GITHUB_OWNER_ID in wrangler.toml to enable admin access.

[90mstdout[2m | tests/unit/github-oauth-flow.test.ts[2m > [22m[2mGitHub Auth API[2m > [22m[2mGET /api/auth/github/callback[2m > [22m[2mshould mark first admin login as completed[22m[39m
[Auth] Owner check by ID: githubUser.id=12345, appOwnerId=12345, match=true
Γ£ô Admin first login completed - setup page is now locked

 [32mΓ£ô[39m tests/unit/github-oauth-flow.test.ts [2m ([22m[2m15 tests[22m[2m)[22m[90m 77[2mms[22m[39m
[90mstdout[2m | tests/unit/openai-chat-service.test.ts[2m > [22m[2mOpenAI Chat Service[2m > [22m[2mcreateRealtimeSession[2m > [22m[2mshould create ephemeral token for realtime API[22m[39m
Creating realtime session for model: gpt-4o-realtime-preview-2024-12-17
Realtime session API response keys: [ [32m'client_secret'[39m ]
Full response data: {
  "client_secret": {
    "value": "eph_token_12345"
  }
}
Successfully got client_secret, length: [33m15[39m
Session ID: [90mundefined[39m
Expires at: [90mundefined[39m

[90mstdout[2m | tests/unit/openai-chat-service.test.ts[2m > [22m[2mOpenAI Chat Service[2m > [22m[2mcreateRealtimeSession[2m > [22m[2mshould handle session creation errors[22m[39m
Creating realtime session for model: gpt-4o-realtime-preview-2024-12-17

[90mstderr[2m | tests/unit/openai-chat-service.test.ts[2m > [22m[2mOpenAI 
Chat Service[2m > [22m[2mcreateRealtimeSession[2m > [22m[2mshould handle 
session creation errors[22m[39m
Failed to create realtime session: [33m500[39m Internal Server Error

[90mstdout[2m | tests/unit/openai-chat-service.test.ts[2m > [22m[2mOpenAI Chat Service[2m > [22m[2mcreateRealtimeSession error handling[2m > [22m[2mshould throw when client_secret is missing from response[22m[39m
Creating realtime session for model: gpt-4o-realtime-preview-2024-12-17
Realtime session API response keys: [ [32m'id'[39m ]
Full response data: {
  "id": "session-123"
}

[90mstdout[2m | tests/unit/openai-chat-service.test.ts[2m > [22m[2mOpenAI Chat Service[2m > [22m[2mcreateRealtimeSession error handling[2m > [22m[2mshould throw when client_secret.value is missing[22m[39m
Creating realtime session for model: gpt-4o-realtime-preview-2024-12-17
Realtime session API response keys: [ [32m'client_secret'[39m ]
Full response data: {
  "client_secret": {}
}

 [32mΓ£ô[39m tests/unit/openai-chat-service.test.ts [2m ([22m[2m17 tests[22m[2m)[22m[90m 50[2mms[22m[39m
 [32mΓ£ô[39m tests/unit/admin-users.test.ts [2m ([22m[2m19 tests[22m[2m)[22m[33m 1642[2mms[22m[39m
[90mstderr[2m | tests/unit/chat-models-api.test.ts[2m > [22m[2mChat 
Models API[2m > [22m[2mshould re-throw errors with status property[22m[39m
Failed to get enabled models: Error: Bad Request
    at [90mC:\Users\monag\_Projects\starspace\nabu\[39mtests\unit\chat-models
-api.test.ts:353:21
    at [90mfile:///C:/Users/monag/_Projects/starspace/nabu/[39mnode_modules/
[4m@vitest/runner[24m/dist/index.js:135:14
    at [90mfile:///C:/Users/monag/_Projects/starspace/nabu/[39mnode_modules/
[4m@vitest/runner[24m/dist/index.js:60:26
    at runTest [90m(file:///C:/Users/monag/_Projects/starspace/nabu/[39mnode_
modules/[4m@vitest/runner[24m/dist/index.js:781:17[90m)[39m
[90m    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)[39m
    at runSuite [90m(file:///C:/Users/monag/_Projects/starspace/nabu/[39mnode
_modules/[4m@vitest/runner[24m/dist/index.js:909:15[90m)[39m
    at runSuite [90m(file:///C:/Users/monag/_Projects/starspace/nabu/[39mnode
_modules/[4m@vitest/runner[24m/dist/index.js:909:15[90m)[39m
    at runFiles [90m(file:///C:/Users/monag/_Projects/starspace/nabu/[39mnode
_modules/[4m@vitest/runner[24m/dist/index.js:958:5[90m)[39m
    at startTests [90m(file:///C:/Users/monag/_Projects/starspace/nabu/[39mno
de_modules/[4m@vitest/runner[24m/dist/index.js:967:3[90m)[39m
    at [90mfile:///C:/Users/monag/_Projects/starspace/nabu/[39mnode_modules/
[4mvitest[24m/dist/chunks/runtime-runBaseTests.oAvMKtQC.js:116:7 {
  status: [33m400[39m
}

 [32mΓ£ô[39m tests/unit/chat-models-api.test.ts [2m ([22m[2m18 tests[22m[2m)[22m[90m 32[2mms[22m[39m
[90mstderr[2m | tests/unit/auth-keys-api.test.ts[2m > [22m[2mAuth Keys 
API[2m > [22m[2mGET /api/admin/auth-keys[2m > [22m[2mshould handle KV 
parse errors gracefully[22m[39m
Failed to parse GitHub OAuth config: SyntaxError: Unexpected token 'i', 
"invalid-json" is not valid JSON
    at JSON.parse (<anonymous>)
    at GET [90m(C:\Users\monag\_Projects\starspace\nabu\[39msrc\routes\api\ad
min\auth-keys\+server.ts:14:30[90m)[39m
    at [90mC:\Users\monag\_Projects\starspace\nabu\[39mtests\unit\auth-keys-a
pi.test.ts:75:21
    at runTest [90m(file:///C:/Users/monag/_Projects/starspace/nabu/[39mnode_
modules/[4m@vitest/runner[24m/dist/index.js:781:11[90m)[39m
    at runSuite [90m(file:///C:/Users/monag/_Projects/starspace/nabu/[39mnode
_modules/[4m@vitest/runner[24m/dist/index.js:909:15[90m)[39m
    at runSuite [90m(file:///C:/Users/monag/_Projects/starspace/nabu/[39mnode
_modules/[4m@vitest/runner[24m/dist/index.js:909:15[90m)[39m
    at runSuite [90m(file:///C:/Users/monag/_Projects/starspace/nabu/[39mnode
_modules/[4m@vitest/runner[24m/dist/index.js:909:15[90m)[39m
    at runFiles [90m(file:///C:/Users/monag/_Projects/starspace/nabu/[39mnode
_modules/[4m@vitest/runner[24m/dist/index.js:958:5[90m)[39m
    at startTests [90m(file:///C:/Users/monag/_Projects/starspace/nabu/[39mno
de_modules/[4m@vitest/runner[24m/dist/index.js:967:3[90m)[39m
    at [90mfile:///C:/Users/monag/_Projects/starspace/nabu/[39mnode_modules/
[4mvitest[24m/dist/chunks/runtime-runBaseTests.oAvMKtQC.js:116:7
Failed to parse Discord OAuth config: SyntaxError: Unexpected token 'i', 
"invalid-json" is not valid JSON
    at JSON.parse (<anonymous>)
    at GET [90m(C:\Users\monag\_Projects\starspace\nabu\[39msrc\routes\api\ad
min\auth-keys\+server.ts:34:33[90m)[39m
    at [90mC:\Users\monag\_Projects\starspace\nabu\[39mtests\unit\auth-keys-a
pi.test.ts:75:21
    at runTest [90m(file:///C:/Users/monag/_Projects/starspace/nabu/[39mnode_
modules/[4m@vitest/runner[24m/dist/index.js:781:11[90m)[39m
    at runSuite [90m(file:///C:/Users/monag/_Projects/starspace/nabu/[39mnode
_modules/[4m@vitest/runner[24m/dist/index.js:909:15[90m)[39m
    at runSuite [90m(file:///C:/Users/monag/_Projects/starspace/nabu/[39mnode
_modules/[4m@vitest/runner[24m/dist/index.js:909:15[90m)[39m
    at runSuite [90m(file:///C:/Users/monag/_Projects/starspace/nabu/[39mnode
_modules/[4m@vitest/runner[24m/dist/index.js:909:15[90m)[39m
    at runFiles [90m(file:///C:/Users/monag/_Projects/starspace/nabu/[39mnode
_modules/[4m@vitest/runner[24m/dist/index.js:958:5[90m)[39m
    at startTests [90m(file:///C:/Users/monag/_Projects/starspace/nabu/[39mno
de_modules/[4m@vitest/runner[24m/dist/index.js:967:3[90m)[39m
    at [90mfile:///C:/Users/monag/_Projects/starspace/nabu/[39mnode_modules/
[4mvitest[24m/dist/chunks/runtime-runBaseTests.oAvMKtQC.js:116:7

[90mstderr[2m | tests/unit/auth-keys-api.test.ts[2m > [22m[2mAuth Keys 
API[2m > [22m[2mPOST /api/admin/auth-keys[2m > [22m[2mshould return 400 
when required fields are missing[22m[39m
Failed to create auth key: HttpError { status: [33m400[39m, body: { message: 
[32m'Missing required fields'[39m } }

[90mstderr[2m | tests/unit/auth-keys-api.test.ts[2m > [22m[2mAuth Keys 
API[2m > [22m[2mPUT /api/admin/auth-keys/[id][2m > [22m[2mshould update 
an auth key[22m[39m
Failed to update auth config in KV: TypeError: platform.env.KV.put is not a 
function
    at PUT [90m(C:\Users\monag\_Projects\starspace\nabu\[39msrc\routes\api\ad
min\auth-keys\[id]\+server.ts:63:27[90m)[39m
    at [90mC:\Users\monag\_Projects\starspace\nabu\[39mtests\unit\auth-keys-a
pi.test.ts:328:21
    at runTest [90m(file:///C:/Users/monag/_Projects/starspace/nabu/[39mnode_
modules/[4m@vitest/runner[24m/dist/index.js:781:11[90m)[39m
    at runSuite [90m(file:///C:/Users/monag/_Projects/starspace/nabu/[39mnode
_modules/[4m@vitest/runner[24m/dist/index.js:909:15[90m)[39m
    at runSuite [90m(file:///C:/Users/monag/_Projects/starspace/nabu/[39mnode
_modules/[4m@vitest/runner[24m/dist/index.js:909:15[90m)[39m
    at runSuite [90m(file:///C:/Users/monag/_Projects/starspace/nabu/[39mnode
_modules/[4m@vitest/runner[24m/dist/index.js:909:15[90m)[39m
    at runFiles [90m(file:///C:/Users/monag/_Projects/starspace/nabu/[39mnode
_modules/[4m@vitest/runner[24m/dist/index.js:958:5[90m)[39m
    at startTests [90m(file:///C:/Users/monag/_Projects/starspace/nabu/[39mno
de_modules/[4m@vitest/runner[24m/dist/index.js:967:3[90m)[39m
    at [90mfile:///C:/Users/monag/_Projects/starspace/nabu/[39mnode_modules/
[4mvitest[24m/dist/chunks/runtime-runBaseTests.oAvMKtQC.js:116:7
    at withEnv [90m(file:///C:/Users/monag/_Projects/starspace/nabu/[39mnode_
modules/[4mvitest[24m/dist/chunks/runtime-runBaseTests.oAvMKtQC.js:83:5[90m)
[39m

 [32mΓ£ô[39m tests/unit/auth-keys-api.test.ts [2m ([22m[2m18 tests[22m[2m)[22m[90m 96[2mms[22m[39m
[90mstderr[2m | tests/unit/admin-users-extended.test.ts[2m > [22m[2mAdmin 
Users Extended API[2m > [22m[2mGET /api/admin/users/search[2m > 
[22m[2mshould handle GitHub API errors[22m[39m
Failed to search GitHub users: HttpError {
  status: [33m500[39m,
  body: { message: [32m'GitHub API request failed'[39m }
}

[90mstderr[2m | tests/unit/admin-users-extended.test.ts[2m > [22m[2mAdmin 
Users Extended API[2m > [22m[2mPATCH /api/admin/users/[id][2m > 
[22m[2mshould return 500 when database is not available[22m[39m
Failed to update user: HttpError { status: [33m500[39m, body: { message: 
[32m'Database not available'[39m } }

[90mstderr[2m | tests/unit/admin-users-extended.test.ts[2m > [22m[2mAdmin 
Users Extended API[2m > [22m[2mPATCH /api/admin/users/[id][2m > 
[22m[2mshould return 404 when user not found[22m[39m
Failed to update user: HttpError { status: [33m404[39m, body: { message: 
[32m'User not found'[39m } }

[90mstderr[2m | tests/unit/admin-users-extended.test.ts[2m > [22m[2mAdmin 
Users Extended API[2m > [22m[2mPATCH /api/admin/users/[id][2m > 
[22m[2mshould return 400 when trying to modify self[22m[39m
Failed to update user: HttpError {
  status: [33m400[39m,
  body: { message: [32m'Cannot modify your own admin status'[39m }
}

[90mstderr[2m | tests/unit/admin-users-extended.test.ts[2m > [22m[2mAdmin 
Users Extended API[2m > [22m[2mPATCH /api/admin/users/[id][2m > 
[22m[2mshould prevent demoting setup owner[22m[39m
Failed to update user: HttpError {
  status: [33m400[39m,
  body: { message: [32m'Cannot demote the setup owner'[39m }
}

[90mstderr[2m | tests/unit/admin-users-extended.test.ts[2m > [22m[2mAdmin 
Users Extended API[2m > [22m[2mDELETE /api/admin/users/[id][2m > 
[22m[2mshould return 400 when trying to delete self[22m[39m
Failed to delete user: HttpError {
  status: [33m400[39m,
  body: { message: [32m'Cannot delete your own account'[39m }
}

[90mstderr[2m | tests/unit/admin-users-extended.test.ts[2m > [22m[2mAdmin 
Users Extended API[2m > [22m[2mDELETE /api/admin/users/[id][2m > 
[22m[2mshould return 404 when user not found[22m[39m
Failed to delete user: HttpError { status: [33m404[39m, body: { message: 
[32m'User not found'[39m } }

[90mstderr[2m | tests/unit/admin-users-extended.test.ts[2m > [22m[2mAdmin 
Users Extended API[2m > [22m[2mDELETE /api/admin/users/[id][2m > 
[22m[2mshould prevent deleting setup owner[22m[39m
Failed to delete user: HttpError {
  status: [33m400[39m,
  body: { message: [32m'Cannot delete the setup owner'[39m }
}

 [32mΓ£ô[39m tests/unit/admin-users-extended.test.ts [2m ([22m[2m21 tests[22m[2m)[22m[90m 84[2mms[22m[39m
 [32mΓ£ô[39m tests/unit/chat-page-server.test.ts [2m ([22m[2m19 tests[22m[2m)[22m[90m 68[2mms[22m[39m
 [32mΓ£ô[39m tests/unit/admin-ai-keys.test.ts [2m ([22m[2m18 tests[22m[2m)[22m[90m 189[2mms[22m[39m
 [32mΓ£ô[39m tests/unit/profile-page-server-extended.test.ts [2m ([22m[2m12 tests[22m[2m)[22m[90m 62[2mms[22m[39m
 [32mΓ£ô[39m tests/unit/voice-button.test.ts [2m ([22m[2m30 tests[22m[2m)[22m[90m 160[2mms[22m[39m
 [32mΓ£ô[39m tests/unit/theme-store.test.ts [2m ([22m[2m16 tests[22m[2m)[22m[33m 527[2mms[22m[39m
 [32mΓ£ô[39m tests/unit/auth-connections-extended.test.ts [2m ([22m[2m11 tests[22m[2m)[22m[90m 62[2mms[22m[39m
 [32mΓ£ô[39m tests/unit/voice-chat-audio.test.ts [2m ([22m[2m18 tests[22m[2m)[22m[90m 34[2mms[22m[39m
[90mstderr[2m | tests/unit/admin-cms-pages.test.ts[2m > [22m[2mAdmin CMS 
Dashboard Page Server[2m > [22m[2mshould return empty array when fetch 
throws[22m[39m
Failed to load CMS data: Error: Network error
    at [90mC:\Users\monag\_Projects\starspace\nabu\[39mtests\unit\admin-cms-p
ages.test.ts:46:31
    at [90mfile:///C:/Users/monag/_Projects/starspace/nabu/[39mnode_modules/
[4m@vitest/runner[24m/dist/index.js:135:14
    at [90mfile:///C:/Users/monag/_Projects/starspace/nabu/[39mnode_modules/
[4m@vitest/runner[24m/dist/index.js:60:26
    at runTest [90m(file:///C:/Users/monag/_Projects/starspace/nabu/[39mnode_
modules/[4m@vitest/runner[24m/dist/index.js:781:17[90m)[39m
    at runSuite [90m(file:///C:/Users/monag/_Projects/starspace/nabu/[39mnode
_modules/[4m@vitest/runner[24m/dist/index.js:909:15[90m)[39m
    at runSuite [90m(file:///C:/Users/monag/_Projects/starspace/nabu/[39mnode
_modules/[4m@vitest/runner[24m/dist/index.js:909:15[90m)[39m
    at runFiles [90m(file:///C:/Users/monag/_Projects/starspace/nabu/[39mnode
_modules/[4m@vitest/runner[24m/dist/index.js:958:5[90m)[39m
    at startTests [90m(file:///C:/Users/monag/_Projects/starspace/nabu/[39mno
de_modules/[4m@vitest/runner[24m/dist/index.js:967:3[90m)[39m
    at [90mfile:///C:/Users/monag/_Projects/starspace/nabu/[39mnode_modules/
[4mvitest[24m/dist/chunks/runtime-runBaseTests.oAvMKtQC.js:116:7
    at withEnv [90m(file:///C:/Users/monag/_Projects/starspace/nabu/[39mnode_
modules/[4mvitest[24m/dist/chunks/runtime-runBaseTests.oAvMKtQC.js:83:5[90m)
[39m

 [32mΓ£ô[39m tests/unit/admin-cms-pages.test.ts [2m ([22m[2m14 tests[22m[2m)[22m[90m 35[2mms[22m[39m
[90mstdout[2m | tests/unit/social-account-linking.test.ts[2m > [22m[2mProfile Connected Accounts Display[2m > [22m[2mshould load connected accounts data for profile page[22m[39m
[Profile] Loading for user: user-123 login: testuser
[Profile] DB available, fetching oauth_accounts
[Profile] oauth_accounts query result: {"results":[{"provider":"github","provider_account_id":"12345","created_at":"2024-01-01"},{"provider":"discord","provider_account_id":"67890","created_at":"2024-01-02"}]}
[Profile] hasGitHubConnection: [33mtrue[39m user.login: testuser
[Profile] Returning connectedAccounts: [{"provider":"github","provider_account_id":"12345","created_at":"2024-01-01"},{"provider":"discord","provider_account_id":"67890","created_at":"2024-01-02"}]

[90mstdout[2m | tests/unit/social-account-linking.test.ts[2m > [22m[2mProfile Connected Accounts Display[2m > [22m[2mshould return empty connected accounts when DB not available[22m[39m
[Profile] Loading for user: user-123 login: testuser
[Profile] Returning connectedAccounts: []

[90mstderr[2m | tests/unit/social-account-linking.test.ts[2m > 
[22m[2mProfile Connected Accounts Display[2m > [22m[2mshould return empty 
connected accounts when DB not available[22m[39m
[Profile] Database not available for fetching connected accounts

 [32mΓ£ô[39m tests/unit/social-account-linking.test.ts [2m ([22m[2m11 tests[22m[2m)[22m[90m 33[2mms[22m[39m
[90mstdout[2m | tests/unit/social-account-linking.test.ts[2m > [22m[2mProfile Connected Accounts Display[2m > [22m[2mshould return empty connected accounts for Discord user when DB not available[22m[39m
[Profile] Loading for user: discord_987654321 login: discorduser
[Profile] Returning connectedAccounts: []

[90mstderr[2m | tests/unit/social-account-linking.test.ts[2m > 
[22m[2mProfile Connected Accounts Display[2m > [22m[2mshould return empty 
connected accounts for Discord user when DB not available[22m[39m
[Profile] Database not available for fetching connected accounts

 [32mΓ£ô[39m tests/unit/cms-utils.test.ts [2m ([22m[2m27 tests[22m[2m)[22m[90m 5[2mms[22m[39m
 [32mΓ£ô[39m tests/unit/db-utils.test.ts [2m ([22m[2m14 tests[22m[2m)[22m[90m 63[2mms[22m[39m
[90mstdout[2m | tests/unit/admin-ai-keys-voice.test.ts[2m > [22m[2mAI Keys Voice Chat Configuration[2m > [22m[2mVoice Session Creation with voice settings[2m > [22m[2mshould create voice session when voice is enabled[22m[39m
Creating realtime session with model: gpt-4o-realtime-preview-2024-12-17
Creating realtime session for model: gpt-4o-realtime-preview-2024-12-17
Realtime session API response keys: [ [32m'client_secret'[39m ]
Full response data: {
  "client_secret": {
    "value": "ephemeral-token"
  }
}
Successfully got client_secret, length: [33m15[39m
Session ID: [90mundefined[39m
Expires at: [90mundefined[39m
[90mstderr[2m | tests/unit/admin-ai-keys-voice.test.ts[2m > [22m[2mAI 
Keys Voice Chat Configuration[2m > [22m[2mVoice Session Creation with voice 
settings[2m > [22m[2mshould return 403 when voice is not enabled[22m[39m
Voice session error: HttpError {
  status: [33m403[39m,
  body: { message: [32m'Voice chat is not enabled'[39m }
}
Error details: [90mundefined[39m [33m403[39m

Realtime session created, token length: [33m15[39m
Token prefix: ephemeral-token...

[90mstdout[2m | tests/unit/admin-ai-keys-voice.test.ts[2m > [22m[2mAI Keys Voice Chat Configuration[2m > [22m[2mVoice Session Creation with voice settings[2m > [22m[2mshould use custom voice model when configured[22m[39m
Creating realtime session with model: gpt-4o-realtime-preview-2024-12-17
Creating realtime session for model: gpt-4o-realtime-preview-2024-12-17
Realtime session API response keys: [ [32m'client_secret'[39m ]
Full response data: {
  "client_secret": {
    "value": "ephemeral-token"
  }
}
Successfully got client_secret, length: [33m15[39m
Session ID: [90mundefined[39m
Expires at: [90mundefined[39m
Realtime session created, token length: [33m15[39m
Token prefix: ephemeral-token...

 [32mΓ£ô[39m tests/unit/admin-ai-keys-voice.test.ts [2m ([22m[2m7 tests[22m[2m)[22m[90m 36[2mms[22m[39m
[90mstderr[2m | tests/unit/admin-users-api.test.ts[2m > [22m[2mAdmin 
Users API[2m > [22m[2mPOST /api/admin/users[2m > [22m[2mshould validate 
required fields[22m[39m
Failed to invite user: HttpError {
  status: [33m400[39m,
  body: { message: [32m'GitHub login and email are required'[39m }
}

[90mstderr[2m | tests/unit/admin-users-api.test.ts[2m > [22m[2mAdmin 
Users API[2m > [22m[2mPATCH /api/admin/users/:id[2m > [22m[2mshould 
prevent user from modifying their own status[22m[39m
Failed to update user: HttpError {
  status: [33m400[39m,
  body: { message: [32m'Cannot modify your own admin status'[39m }
}

[90mstderr[2m | tests/unit/admin-users-api.test.ts[2m > [22m[2mAdmin 
Users API[2m > [22m[2mDELETE /api/admin/users/:id[2m > [22m[2mshould 
prevent user from deleting themselves[22m[39m
Failed to delete user: HttpError {
  status: [33m400[39m,
  body: { message: [32m'Cannot delete your own account'[39m }
}

 [32mΓ£ô[39m tests/unit/admin-users-api.test.ts [2m ([22m[2m15 tests[22m[2m)[22m[90m 30[2mms[22m[39m
 [2m[90mΓåô[39m[22m tests/unit/github-callback-extended.test.ts [2m ([22m[2m9 tests[22m [2m|[22m [33m9 skipped[39m[2m)[22m
[90mstderr[2m | tests/unit/setup-api-extended.test.ts[2m > [22m[2mSetup 
API[2m > [22m[2mGET /api/setup[2m > [22m[2mshould handle KV errors 
gracefully[22m[39m
Failed to check setup status: Error: KV Error
    at [90mC:\Users\monag\_Projects\starspace\nabu\[39mtests\unit\setup-api-e
xtended.test.ts:76:38
    at [90mfile:///C:/Users/monag/_Projects/starspace/nabu/[39mnode_modules/
[4m@vitest/runner[24m/dist/index.js:135:14
    at [90mfile:///C:/Users/monag/_Projects/starspace/nabu/[39mnode_modules/
[4m@vitest/runner[24m/dist/index.js:60:26
    at runTest [90m(file:///C:/Users/monag/_Projects/starspace/nabu/[39mnode_
modules/[4m@vitest/runner[24m/dist/index.js:781:17[90m)[39m
[90m    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)[39m
    at runSuite [90m(file:///C:/Users/monag/_Projects/starspace/nabu/[39mnode
_modules/[4m@vitest/runner[24m/dist/index.js:909:15[90m)[39m
    at runSuite [90m(file:///C:/Users/monag/_Projects/starspace/nabu/[39mnode
_modules/[4m@vitest/runner[24m/dist/index.js:909:15[90m)[39m
    at runSuite [90m(file:///C:/Users/monag/_Projects/starspace/nabu/[39mnode
_modules/[4m@vitest/runner[24m/dist/index.js:909:15[90m)[39m
    at runFiles [90m(file:///C:/Users/monag/_Projects/starspace/nabu/[39mnode
_modules/[4m@vitest/runner[24m/dist/index.js:958:5[90m)[39m
    at startTests [90m(file:///C:/Users/monag/_Projects/starspace/nabu/[39mno
de_modules/[4m@vitest/runner[24m/dist/index.js:967:3[90m)[39m

[90mstderr[2m | tests/unit/setup-api-extended.test.ts[2m > [22m[2mSetup 
API[2m > [22m[2mPOST /api/setup[2m > [22m[2mshould return 403 when setup 
is locked[22m[39m
Failed to save setup configuration: HttpError {
  status: [33m403[39m,
  body: {
    message: [32m'Setup is locked. The admin user has already logged in. 
Setup can only be performed once.'[39m
  }
}

[90mstderr[2m | tests/unit/setup-api-extended.test.ts[2m > [22m[2mSetup 
API[2m > [22m[2mPOST /api/setup[2m > [22m[2mshould return 400 when 
client credentials missing for new setup[22m[39m
Failed to save setup configuration: HttpError {
  status: [33m400[39m,
  body: { message: [32m'Client ID and Client Secret are required'[39m }
}

[90mstderr[2m | tests/unit/setup-api-extended.test.ts[2m > [22m[2mSetup 
API[2m > [22m[2mPOST /api/setup[2m > [22m[2mshould return 400 when admin 
username is missing[22m[39m
Failed to save setup configuration: HttpError {
  status: [33m400[39m,
  body: { message: [32m'Admin GitHub Username is required'[39m }
}

[90mstderr[2m | tests/unit/setup-api-extended.test.ts[2m > [22m[2mSetup 
API[2m > [22m[2mPOST /api/setup[2m > [22m[2mshould return 400 for 
invalid GitHub username format[22m[39m
Failed to save setup configuration: HttpError {
  status: [33m400[39m,
  body: { message: [32m'Invalid GitHub username format'[39m }
}

[90mstdout[2m | tests/unit/setup-api-extended.test.ts[2m > [22m[2mSetup API[2m > [22m[2mPOST /api/setup[2m > [22m[2mshould save config when valid data provided[22m[39m
Γ£ô Resolved admin GitHub user: testuser (ID: 12345)
Γ£ô Saved auth config to KV: { id: [32m'config-uuid'[39m, provider: [32m'github'[39m, clientId: [32m'test-client'[39m }
Γ£ô Saved admin owner to KV: testuser (ID: 12345)

[90mstderr[2m | tests/unit/setup-api-extended.test.ts[2m > [22m[2mSetup 
API[2m > [22m[2mPOST /api/setup[2m > [22m[2mshould handle GitHub API 404 
error[22m[39m
Failed to fetch GitHub user: HttpError {
  status: [33m404[39m,
  body: { message: [32m"GitHub user 'nonexistent-user-12345' not found"[39m }
}
Failed to save setup configuration: HttpError {
  status: [33m500[39m,
  body: { message: [32m'Failed to verify GitHub username'[39m }
}

[90mstdout[2m | tests/unit/setup-api-extended.test.ts[2m > [22m[2mSetup API[2m > [22m[2mPOST /api/setup[2m > [22m[2mshould work without KV (development mode)[22m[39m
Γ£ô Resolved admin GitHub user: testuser (ID: 12345)

[90mstderr[2m | tests/unit/setup-api-extended.test.ts[2m > [22m[2mSetup 
API[2m > [22m[2mPOST /api/setup[2m > [22m[2mshould work without KV 
(development mode)[22m[39m
ΓÜá∩╕Å  KV not available. Setup KV namespace for local dev:
   wrangler kv:namespace create "KV" --preview
   Then update wrangler.toml with the preview_id

Or use .dev.vars file:
   GITHUB_CLIENT_ID=test-client
   GITHUB_CLIENT_SECRET=test-secret
   GITHUB_OWNER_ID=12345
   # Admin user: @testuser (ID: 12345)

[90mstdout[2m | tests/unit/setup-api-extended.test.ts[2m > [22m[2mSetup API[2m > [22m[2mPOST /api/setup[2m > [22m[2mshould allow updating admin without credentials when config exists[22m[39m
Γ£ô Resolved admin GitHub user: newadmin (ID: 67890)
Γ£ô Saved auth config to KV: { id: [32m'existing-id'[39m, provider: [32m'github'[39m, clientId: [90mundefined[39m }
Γ£ô Saved admin owner to KV: newadmin (ID: 67890)

 [32mΓ£ô[39m tests/unit/setup-api-extended.test.ts [2m ([22m[2m12 tests[22m[2m)[22m[90m 78[2mms[22m[39m
[90mstderr[2m | tests/unit/openai-models-api.test.ts[2m > [22m[2mOpenAI 
Models API[2m > [22m[2mGET /api/admin/ai-keys/models[2m > [22m[2mshould 
handle OpenAI API errors gracefully[22m[39m
Failed to fetch OpenAI models: [33m401[39m Invalid API key

 [32mΓ£ô[39m tests/unit/openai-models-api.test.ts [2m ([22m[2m7 tests[22m[2m)[22m[90m 62[2mms[22m[39m
[90mstderr[2m | tests/unit/discord-auth.test.ts[2m > [22m[2mDiscord OAuth 
- Callback[2m > [22m[2mshould redirect to login with error when Discord 
OAuth not configured[22m[39m
Discord OAuth not configured - missing clientId or clientSecret

[90mstderr[2m | tests/unit/discord-auth.test.ts[2m > [22m[2mDiscord OAuth 
- Callback[2m > [22m[2mshould handle token exchange failure[22m[39m
Failed to exchange code for token: [33m400[39m Bad Request

[90mstderr[2m | tests/unit/discord-auth.test.ts[2m > [22m[2mDiscord OAuth 
- Callback[2m > [22m[2mshould handle user fetch failure[22m[39m
Failed to fetch user info: [33m401[39m Unauthorized

 [32mΓ£ô[39m tests/unit/discord-auth.test.ts [2m ([22m[2m9 tests[22m[2m)[22m[90m 49[2mms[22m[39m
[90mstderr[2m | tests/unit/setup-api-branches.test.ts[2m > [22m[2mSetup 
API - Extended Branch Coverage[2m > [22m[2mPOST - Save setup 
configuration[2m > [22m[2mshould throw 403 when setup is already 
locked[22m[39m
Failed to save setup configuration: HttpError {
  status: [33m403[39m,
  body: {
    message: [32m'Setup is locked. The admin user has already logged in. 
Setup can only be performed once.'[39m
  }
}

[90mstderr[2m | tests/unit/setup-api-branches.test.ts[2m > [22m[2mSetup 
API - Extended Branch Coverage[2m > [22m[2mPOST - Save setup 
configuration[2m > [22m[2mshould throw 400 when clientId is missing and no 
existing config[22m[39m
Failed to save setup configuration: HttpError {
  status: [33m400[39m,
  body: { message: [32m'Client ID and Client Secret are required'[39m }
}

[90mstderr[2m | tests/unit/setup-api-branches.test.ts[2m > [22m[2mSetup 
API - Extended Branch Coverage[2m > [22m[2mPOST - Save setup 
configuration[2m > [22m[2mshould throw 400 when clientSecret is missing and 
no existing config[22m[39m
Failed to save setup configuration: HttpError {
  status: [33m400[39m,
  body: { message: [32m'Client ID and Client Secret are required'[39m }
}

[90mstderr[2m | tests/unit/setup-api-branches.test.ts[2m > [22m[2mSetup 
API - Extended Branch Coverage[2m > [22m[2mPOST - Save setup 
configuration[2m > [22m[2mshould throw 400 when adminGithubUsername is 
empty[22m[39m
Failed to save setup configuration: HttpError {
  status: [33m400[39m,
  body: { message: [32m'Admin GitHub Username is required'[39m }
}

[90mstderr[2m | tests/unit/setup-api-branches.test.ts[2m > [22m[2mSetup 
API - Extended Branch Coverage[2m > [22m[2mPOST - Save setup 
configuration[2m > [22m[2mshould throw 400 for invalid GitHub username 
format[22m[39m
Failed to save setup configuration: HttpError {
  status: [33m400[39m,
  body: { message: [32m'Invalid GitHub username format'[39m }
}

[90mstdout[2m | tests/unit/setup-api-branches.test.ts[2m > [22m[2mSetup API - Extended Branch Coverage[2m > [22m[2mPOST - Save setup configuration[2m > [22m[2mshould allow update with existing config and no new credentials[22m[39m
Γ£ô Resolved admin GitHub user: testuser (ID: 12345)
Γ£ô Saved auth config to KV: { id: [32m'existing-id'[39m, provider: [32m'github'[39m, clientId: [90mundefined[39m }
Γ£ô Saved admin owner to KV: testuser (ID: 12345)

[90mstderr[2m | tests/unit/setup-api-branches.test.ts[2m > [22m[2mSetup 
API - Extended Branch Coverage[2m > [22m[2mPOST - Save setup 
configuration[2m > [22m[2mshould throw 404 when GitHub user is not 
found[22m[39m
Failed to fetch GitHub user: HttpError {
  status: [33m404[39m,
  body: { message: [32m"GitHub user 'testuser' not found"[39m }
}
Failed to save setup configuration: HttpError {
  status: [33m500[39m,
  body: { message: [32m'Failed to verify GitHub username'[39m }
}

[90mstderr[2m | tests/unit/setup-api-branches.test.ts[2m > [22m[2mSetup 
API - Extended Branch Coverage[2m > [22m[2mPOST - Save setup 
configuration[2m > [22m[2mshould throw 500 for non-404 GitHub API 
errors[22m[39m
Failed to fetch GitHub user: HttpError {
  status: [33m500[39m,
  body: { message: [32m'Failed to fetch GitHub user information'[39m }
}
Failed to save setup configuration: HttpError {
  status: [33m500[39m,
  body: { message: [32m'Failed to verify GitHub username'[39m }
}

[90mstdout[2m | tests/unit/setup-api-branches.test.ts[2m > [22m[2mSetup API - Extended Branch Coverage[2m > [22m[2mPOST - Save setup configuration[2m > [22m[2mshould return success message when KV is available[22m[39m
Γ£ô Resolved admin GitHub user: testuser (ID: 12345)
Γ£ô Saved auth config to KV: {
  id: [32m'69ae5ec2-cf96-4833-8381-0069cbc30449'[39m,
  provider: [32m'github'[39m,
  clientId: [32m'test-client-id'[39m
}
Γ£ô Saved admin owner to KV: testuser (ID: 12345)

[90mstdout[2m | tests/unit/setup-api-branches.test.ts[2m > [22m[2mSetup API - Extended Branch Coverage[2m > [22m[2mPOST - Save setup configuration[2m > [22m[2mshould return instructions when KV is not available[22m[39m
Γ£ô Resolved admin GitHub user: testuser (ID: 12345)

[90mstdout[2m | tests/unit/setup-api-branches.test.ts[2m > [22m[2mSetup API - Extended Branch Coverage[2m > [22m[2mPOST - Save setup configuration[2m > [22m[2mshould default to github provider when not specified[22m[39m
Γ£ô Resolved admin GitHub user: testuser (ID: 12345)
Γ£ô Saved auth config to KV: {
  id: [32m'4b67429b-51f7-422d-9164-aba957ed97d1'[39m,
  provider: [32m'github'[39m,
  clientId: [32m'test-client-id'[39m
}
Γ£ô Saved admin owner to KV: testuser (ID: 12345)

[90mstdout[2m | tests/unit/setup-api-branches.test.ts[2m > [22m[2mSetup API - Extended Branch Coverage[2m > [22m[2mPOST - Save setup configuration[2m > [22m[2mshould use specified provider when provided[22m[39m
Γ£ô Resolved admin GitHub user: testuser (ID: 12345)
Γ£ô Saved auth config to KV: {
  id: [32m'8bdb8c5f-1984-4237-bbb2-159f3a32c77d'[39m,
  provider: [32m'gitlab'[39m,
  clientId: [32m'id'[39m
}
Γ£ô Saved admin owner to KV: testuser (ID: 12345)

 [32mΓ£ô[39m tests/unit/setup-api-branches.test.ts [2m ([22m[2m16 tests[22m[2m)[22m[90m 13[2mms[22m[39m
 [32mΓ£ô[39m tests/unit/error-page.test.ts [2m ([22m[2m23 tests[22m[2m)[22m[90m 30[2mms[22m[39m
 [32mΓ£ô[39m tests/unit/setup-restriction.test.ts [2m ([22m[2m11 tests[22m[2m)[22m[90m 13[2mms[22m[39m
 [32mΓ£ô[39m tests/unit/admin-auth-keys.test.ts [2m ([22m[2m13 tests[22m[2m)[22m[90m 83[2mms[22m[39m
[90mstdout[2m | tests/unit/profile-page.test.ts[2m > [22m[2mProfile Page[2m > [22m[2mServer Load Function[2m > [22m[2mshould return user data when authenticated[22m[39m
[Profile] Loading for user: test-user-id login: testuser
[Profile] Returning connectedAccounts: []

[90mstdout[2m | tests/unit/profile-page.test.ts[2m > [22m[2mProfile Page[2m > [22m[2mServer Load Function[2m > [22m[2mshould handle user without optional fields[22m[39m
[Profile] Loading for user: test-user-id login: testuser
[Profile] Returning connectedAccounts: []

[90mstderr[2m | tests/unit/profile-page.test.ts[2m > [22m[2mProfile 
Page[2m > [22m[2mServer Load Function[2m > [22m[2mshould return user 
data when authenticated[22m[39m
[Profile] Database not available for fetching connected accounts

[90mstderr[2m | tests/unit/profile-page.test.ts[2m > [22m[2mProfile 
Page[2m > [22m[2mServer Load Function[2m > [22m[2mshould handle user 
without optional fields[22m[39m
[Profile] Database not available for fetching connected accounts

 [32mΓ£ô[39m tests/unit/profile-page.test.ts [2m ([22m[2m9 tests[22m[2m)[22m[90m 166[2mms[22m[39m
 [32mΓ£ô[39m tests/unit/setup-page.test.ts [2m ([22m[2m15 tests[22m[2m)[22m[33m 813[2mms[22m[39m
 [32mΓ£ô[39m tests/unit/cost-utility.test.ts [2m ([22m[2m24 tests[22m[2m)[22m[90m 5[2mms[22m[39m
 [32mΓ£ô[39m tests/unit/auth-login-page-extended.test.ts [2m ([22m[2m11 tests[22m[2m)[22m[90m 62[2mms[22m[39m
 [32mΓ£ô[39m tests/unit/admin-auth-keys-setup-oauth.test.ts [2m ([22m[2m11 tests[22m[2m)[22m[90m 23[2mms[22m[39m
 [32mΓ£ô[39m src/lib/utils/contrast.test.ts [2m ([22m[2m21 tests[22m[2m)[22m[90m 4[2mms[22m[39m
 [32mΓ£ô[39m tests/unit/admin-dashboard-setup-info.test.ts [2m ([22m[2m12 tests[22m[2m)[22m[90m 12[2mms[22m[39m
[90mstdout[2m | tests/unit/account-merge.test.ts[2m > [22m[2mAccount Merge Service[2m > [22m[2mmergeAccounts[2m > [22m[2mshould transfer all oauth_accounts from source user to target user[22m[39m
[Account Merge] Merging user source-user-id into target-user-id
[Account Merge] Successfully merged user source-user-id into target-user-id

[90mstdout[2m | tests/unit/account-merge.test.ts[2m > [22m[2mAccount Merge Service[2m > [22m[2mmergeAccounts[2m > [22m[2mshould transfer all chat_messages from source user to target user[22m[39m
[Account Merge] Merging user source-user-id into target-user-id
[Account Merge] Successfully merged user source-user-id into target-user-id

[90mstdout[2m | tests/unit/account-merge.test.ts[2m > [22m[2mAccount Merge Service[2m > [22m[2mmergeAccounts[2m > [22m[2mshould transfer all sessions from source user to target user[22m[39m
[Account Merge] Merging user source-user-id into target-user-id
[Account Merge] Successfully merged user source-user-id into target-user-id

[90mstdout[2m | tests/unit/account-merge.test.ts[2m > [22m[2mAccount Merge Service[2m > [22m[2mmergeAccounts[2m > [22m[2mshould delete the source user after transferring data[22m[39m
[Account Merge] Merging user source-user-id into target-user-id
[Account Merge] Successfully merged user source-user-id into target-user-id

[90mstdout[2m | tests/unit/account-merge.test.ts[2m > [22m[2mAccount Merge Service[2m > [22m[2mmergeAccounts[2m > [22m[2mshould merge admin status (source is admin should make target admin)[22m[39m
[Account Merge] Merging user admin-source-id into target-user-id
[Account Merge] Successfully merged user admin-source-id into target-user-id

[90mstdout[2m | tests/unit/account-merge.test.ts[2m > [22m[2mAccount Merge Service[2m > [22m[2mmergeAccounts[2m > [22m[2mshould use batch operations for atomic updates[22m[39m
[Account Merge] Merging user source-user-id into target-user-id
[Account Merge] Successfully merged user source-user-id into target-user-id

 [32mΓ£ô[39m tests/unit/account-merge.test.ts [2m ([22m[2m8 tests[22m[2m)[22m[90m 21[2mms[22m[39m
[90mstderr[2m | tests/unit/auth-keys-id-extended.test.ts[2m > [22m[2mAuth 
Keys [id] API - Extended Branch Coverage[2m > [22m[2mPUT - Update auth 
key[2m > [22m[2mshould allow update when no auth config exists in 
KV[22m[39m
Failed to update auth config in KV: TypeError: platform.env.KV.put is not a 
function
    at Module.PUT [90m(C:\Users\monag\_Projects\starspace\nabu\[39msrc\routes
\api\admin\auth-keys\[id]\+server.ts:63:27[90m)[39m
    at [90mC:\Users\monag\_Projects\starspace\nabu\[39mtests\unit\auth-keys-i
d-extended.test.ts:53:21
    at runTest [90m(file:///C:/Users/monag/_Projects/starspace/nabu/[39mnode_
modules/[4m@vitest/runner[24m/dist/index.js:781:11[90m)[39m
    at runSuite [90m(file:///C:/Users/monag/_Projects/starspace/nabu/[39mnode
_modules/[4m@vitest/runner[24m/dist/index.js:909:15[90m)[39m
    at runSuite [90m(file:///C:/Users/monag/_Projects/starspace/nabu/[39mnode
_modules/[4m@vitest/runner[24m/dist/index.js:909:15[90m)[39m
    at runSuite [90m(file:///C:/Users/monag/_Projects/starspace/nabu/[39mnode
_modules/[4m@vitest/runner[24m/dist/index.js:909:15[90m)[39m
    at runFiles [90m(file:///C:/Users/monag/_Projects/starspace/nabu/[39mnode
_modules/[4m@vitest/runner[24m/dist/index.js:958:5[90m)[39m
    at startTests [90m(file:///C:/Users/monag/_Projects/starspace/nabu/[39mno
de_modules/[4m@vitest/runner[24m/dist/index.js:967:3[90m)[39m
    at [90mfile:///C:/Users/monag/_Projects/starspace/nabu/[39mnode_modules/
[4mvitest[24m/dist/chunks/runtime-runBaseTests.oAvMKtQC.js:116:7
    at withEnv [90m(file:///C:/Users/monag/_Projects/starspace/nabu/[39mnode_
modules/[4mvitest[24m/dist/chunks/runtime-runBaseTests.oAvMKtQC.js:83:5[90m)
[39m

[90mstderr[2m | tests/unit/auth-keys-id-extended.test.ts[2m > [22m[2mAuth 
Keys [id] API - Extended Branch Coverage[2m > [22m[2mPUT - Update auth 
key[2m > [22m[2mshould allow update when key ID does not match setup 
key[22m[39m
Failed to update auth config in KV: TypeError: platform.env.KV.put is not a 
function
    at Module.PUT [90m(C:\Users\monag\_Projects\starspace\nabu\[39msrc\routes
\api\admin\auth-keys\[id]\+server.ts:63:27[90m)[39m
[90m    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)[39m
    at [90mC:\Users\monag\_Projects\starspace\nabu\[39mtests\unit\auth-keys-i
d-extended.test.ts:63:21
    at runTest [90m(file:///C:/Users/monag/_Projects/starspace/nabu/[39mnode_
modules/[4m@vitest/runner[24m/dist/index.js:781:11[90m)[39m
    at runSuite [90m(file:///C:/Users/monag/_Projects/starspace/nabu/[39mnode
_modules/[4m@vitest/runner[24m/dist/index.js:909:15[90m)[39m
    at runSuite [90m(file:///C:/Users/monag/_Projects/starspace/nabu/[39mnode
_modules/[4m@vitest/runner[24m/dist/index.js:909:15[90m)[39m
    at runSuite [90m(file:///C:/Users/monag/_Projects/starspace/nabu/[39mnode
_modules/[4m@vitest/runner[24m/dist/index.js:909:15[90m)[39m
    at runFiles [90m(file:///C:/Users/monag/_Projects/starspace/nabu/[39mnode
_modules/[4m@vitest/runner[24m/dist/index.js:958:5[90m)[39m
    at startTests [90m(file:///C:/Users/monag/_Projects/starspace/nabu/[39mno
de_modules/[4m@vitest/runner[24m/dist/index.js:967:3[90m)[39m
    at [90mfile:///C:/Users/monag/_Projects/starspace/nabu/[39mnode_modules/
[4mvitest[24m/dist/chunks/runtime-runBaseTests.oAvMKtQC.js:116:7

[90mstderr[2m | tests/unit/auth-keys-id-extended.test.ts[2m > [22m[2mAuth 
Keys [id] API - Extended Branch Coverage[2m > [22m[2mPUT - Update auth 
key[2m > [22m[2mshould include all provided fields in updated key[22m[39m
Failed to update auth config in KV: TypeError: platform.env.KV.put is not a 
function
    at Module.PUT [90m(C:\Users\monag\_Projects\starspace\nabu\[39msrc\routes
\api\admin\auth-keys\[id]\+server.ts:63:27[90m)[39m
[90m    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)[39m
    at [90mC:\Users\monag\_Projects\starspace\nabu\[39mtests\unit\auth-keys-i
d-extended.test.ts:119:21
    at runTest [90m(file:///C:/Users/monag/_Projects/starspace/nabu/[39mnode_
modules/[4m@vitest/runner[24m/dist/index.js:781:11[90m)[39m
    at runSuite [90m(file:///C:/Users/monag/_Projects/starspace/nabu/[39mnode
_modules/[4m@vitest/runner[24m/dist/index.js:909:15[90m)[39m
    at runSuite [90m(file:///C:/Users/monag/_Projects/starspace/nabu/[39mnode
_modules/[4m@vitest/runner[24m/dist/index.js:909:15[90m)[39m
    at runSuite [90m(file:///C:/Users/monag/_Projects/starspace/nabu/[39mnode
_modules/[4m@vitest/runner[24m/dist/index.js:909:15[90m)[39m
    at runFiles [90m(file:///C:/Users/monag/_Projects/starspace/nabu/[39mnode
_modules/[4m@vitest/runner[24m/dist/index.js:958:5[90m)[39m
    at startTests [90m(file:///C:/Users/monag/_Projects/starspace/nabu/[39mno
de_modules/[4m@vitest/runner[24m/dist/index.js:967:3[90m)[39m
    at [90mfile:///C:/Users/monag/_Projects/starspace/nabu/[39mnode_modules/
[4mvitest[24m/dist/chunks/runtime-runBaseTests.oAvMKtQC.js:116:7

 [32mΓ£ô[39m tests/unit/auth-keys-id-extended.test.ts [2m ([22m[2m14 tests[22m[2m)[22m[90m 7[2mms[22m[39m
[90mstdout[2m | tests/unit/theme-contrast.test.ts[2m > [22m[2mTheme Contrast Validation[2m > [22m[2mLight Theme[2m > [22m[2mshould warn about any failing contrast ratios[22m[39m
Γ£ô text/background: 17.40:1
Γ£ô text-secondary/background: 6.27:1
Γ£ô primary/background: 5.57:1
Γ£ô text/surface: 16.51:1
Γ£ô text-secondary/surface: 5.95:1

[90mstdout[2m | tests/unit/theme-contrast.test.ts[2m > [22m[2mTheme Contrast Validation[2m > [22m[2mDark Theme[2m > [22m[2mshould warn about any failing contrast ratios[22m[39m
Γ£ô text/background: 18.78:1
Γ£ô text-secondary/background: 9.54:1
Γ£ô primary/background: 5.38:1
Γ£ô text/surface: 16.51:1
Γ£ô text-secondary/surface: 8.39:1

[90mstdout[2m | tests/unit/theme-contrast.test.ts[2m > [22m[2mTheme Contrast Validation[2m > [22m[2mColor Recommendations[2m > [22m[2mshould suggest better colors when contrast fails[22m[39m

≡ƒÄ¿ Color Improvement Suggestions:

  text-secondary/surface:
    Current: #6c757d on #f8f9fa
    Ratio: 4.45:1 (needs 4.5:1)
    Suggestion: Use a darker gray like #5a6169 (5.95:1) or #495057 (7.39:1)

 [32mΓ£ô[39m tests/unit/theme-contrast.test.ts [2m ([22m[2m8 tests[22m[2m)[22m[90m 2[2mms[22m[39m
 [32mΓ£ô[39m tests/unit/admin-ai-keys-toggle.test.ts [2m ([22m[2m7 tests[22m[2m)[22m[90m 19[2mms[22m[39m
[90mstderr[2m | tests/unit/chat-api.test.ts[2m > [22m[2mPOST 
/api/chat/stream - Text Chat Streaming[2m > [22m[2mshould stream chat 
responses from OpenAI[22m[39m
Streaming error: TypeError: Cannot read properties of undefined (reading 'ok')
    at Module.streamChatCompletion [90m(C:\Users\monag\_Projects\starspace\nab
u\[39msrc\lib\services\openai-chat.ts:104:16[90m)[39m
[90m    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)[39m
    at Object.start [90m(C:\Users\monag\_Projects\starspace\nabu\[39msrc\rout
es\api\chat\stream\+server.ts:49:23[90m)[39m

[90mstderr[2m | tests/unit/chat-api.test.ts[2m > [22m[2mPOST 
/api/chat/stream - Text Chat Streaming[2m > [22m[2mshould return 400 if 
messages are invalid[22m[39m
Chat stream error: HttpError { status: [33m400[39m, body: { message: 
[32m'Invalid messages format'[39m } }

[90mstderr[2m | tests/unit/chat-api.test.ts[2m > [22m[2mPOST 
/api/chat/stream - Text Chat Streaming[2m > [22m[2mshould return 503 if no 
OpenAI key is available[22m[39m
Chat stream error: HttpError {
  status: [33m503[39m,
  body: { message: [32m'No OpenAI API key configured'[39m }
}

[90mstdout[2m | tests/unit/chat-api.test.ts[2m > [22m[2mPOST /api/chat/voice/session - Voice Chat Session[2m > [22m[2mshould create ephemeral token for voice chat[22m[39m
Creating realtime session with model: gpt-4o-realtime-preview-2024-12-17
Creating realtime session for model: gpt-4o-realtime-preview-2024-12-17
Realtime session API response keys: [ [32m'client_secret'[39m ]
Full response data: {
  "client_secret": {
    "value": "ephemeral-token-123"
  }
}
Successfully got client_secret, length: [33m19[39m
Session ID: [90mundefined[39m
Expires at: [90mundefined[39m
Realtime session created, token length: [33m19[39m
Token prefix: ephemeral-token-123...

[90mstderr[2m | tests/unit/chat-api.test.ts[2m > [22m[2mPOST 
/api/chat/voice/session - Voice Chat Session[2m > [22m[2mshould return 503 
if no OpenAI key is available[22m[39m
Voice session error: HttpError {
  status: [33m503[39m,
  body: { message: [32m'No OpenAI API key configured'[39m }
}
Error details: [90mundefined[39m [33m503[39m

 [32mΓ£ô[39m tests/unit/chat-api.test.ts [2m ([22m[2m7 tests[22m[2m)[22m[90m 32[2mms[22m[39m
 [32mΓ£ô[39m tests/unit/chat-voice-availability.test.ts [2m ([22m[2m5 tests[22m[2m)[22m[90m 3[2mms[22m[39m
[90mstderr[2m | tests/unit/chat-stream-extended.test.ts[2m > [22m[2mChat 
Stream API - Extended Coverage[2m > [22m[2mshould return 400 when messages 
is not an array[22m[39m
Chat stream error: HttpError { status: [33m400[39m, body: { message: 
[32m'Invalid messages format'[39m } }

[90mstderr[2m | tests/unit/chat-stream-extended.test.ts[2m > [22m[2mChat 
Stream API - Extended Coverage[2m > [22m[2mshould return 400 when messages 
is empty array[22m[39m
Chat stream error: HttpError { status: [33m400[39m, body: { message: 
[32m'Invalid messages format'[39m } }

[90mstderr[2m | tests/unit/chat-stream-extended.test.ts[2m > [22m[2mChat 
Stream API - Extended Coverage[2m > [22m[2mshould return 503 when no OpenAI 
key is configured[22m[39m
Chat stream error: HttpError {
  status: [33m503[39m,
  body: { message: [32m'No OpenAI API key configured'[39m }
}

[90mstderr[2m | tests/unit/chat-stream-extended.test.ts[2m > [22m[2mChat 
Stream API - Extended Coverage[2m > [22m[2mshould re-throw errors with 
status property[22m[39m
Chat stream error: { status: [33m404[39m, message: [32m'Not found'[39m }

 [32mΓ£ô[39m tests/unit/chat-stream-extended.test.ts [2m ([22m[2m11 tests[22m[2m)[22m[90m 17[2mms[22m[39m
 [32mΓ£ô[39m tests/unit/github-auth.test.ts [2m ([22m[2m15 tests[22m[2m)[22m[90m 12[2mms[22m[39m
 [32mΓ£ô[39m tests/unit/admin-pages-server.test.ts [2m ([22m[2m12 tests[22m[2m)[22m[90m 43[2mms[22m[39m
 [32mΓ£ô[39m tests/unit/chat-redirect.test.ts [2m ([22m[2m5 tests[22m[2m)[22m[90m 4[2mms[22m[39m
 [32mΓ£ô[39m tests/unit/setup-api.test.ts [2m ([22m[2m11 tests[22m[2m)[22m[90m 15[2mms[22m[39m
[90mstdout[2m | tests/unit/reset-route-settings.test.ts[2m > [22m[2mReset Route Settings API[2m > [22m[2mPOST /api/admin/settings/reset-route[2m > [22m[2mshould disable reset route successfully[22m[39m
Γ£ô Reset route disabled

[90mstdout[2m | tests/unit/reset-route-settings.test.ts[2m > [22m[2mReset Route Settings API[2m > [22m[2mPOST /api/admin/settings/reset-route[2m > [22m[2mshould enable reset route successfully[22m[39m
Γ£ô Reset route enabled

[90mstderr[2m | tests/unit/reset-route-settings.test.ts[2m > [22m[2mReset 
Route Settings API[2m > [22m[2mPOST /api/admin/settings/reset-route[2m > 
[22m[2mshould handle KV errors gracefully[22m[39m
Failed to update reset route setting: Error: KV Error
    at [90mC:\Users\monag\_Projects\starspace\nabu\[39mtests\unit\reset-route
-settings.test.ts:119:46
[90m    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)[39m
    at runTest [90m(file:///C:/Users/monag/_Projects/starspace/nabu/[39mnode_
modules/[4m@vitest/runner[24m/dist/index.js:781:11[90m)[39m
    at runSuite [90m(file:///C:/Users/monag/_Projects/starspace/nabu/[39mnode
_modules/[4m@vitest/runner[24m/dist/index.js:909:15[90m)[39m
    at runSuite [90m(file:///C:/Users/monag/_Projects/starspace/nabu/[39mnode
_modules/[4m@vitest/runner[24m/dist/index.js:909:15[90m)[39m
    at runSuite [90m(file:///C:/Users/monag/_Projects/starspace/nabu/[39mnode
_modules/[4m@vitest/runner[24m/dist/index.js:909:15[90m)[39m
    at runFiles [90m(file:///C:/Users/monag/_Projects/starspace/nabu/[39mnode
_modules/[4m@vitest/runner[24m/dist/index.js:958:5[90m)[39m
    at startTests [90m(file:///C:/Users/monag/_Projects/starspace/nabu/[39mno
de_modules/[4m@vitest/runner[24m/dist/index.js:967:3[90m)[39m
    at [90mfile:///C:/Users/monag/_Projects/starspace/nabu/[39mnode_modules/
[4mvitest[24m/dist/chunks/runtime-runBaseTests.oAvMKtQC.js:116:7
    at withEnv [90m(file:///C:/Users/monag/_Projects/starspace/nabu/[39mnode_
modules/[4mvitest[24m/dist/chunks/runtime-runBaseTests.oAvMKtQC.js:83:5[90m)
[39m

[90mstdout[2m | tests/unit/reset-route-settings.test.ts[2m > [22m[2mReset Route Settings API[2m > [22m[2mPOST /api/admin/settings/reset-route[2m > [22m[2mshould convert falsy disabled value to false[22m[39m
Γ£ô Reset route enabled

 [32mΓ£ô[39m tests/unit/reset-route-settings.test.ts [2m ([22m[2m7 tests[22m[2m)[22m[90m 18[2mms[22m[39m
 [2m[90mΓåô[39m[22m tests/unit/home-page.test.ts [2m ([22m[2m13 tests[22m [2m|[22m [33m13 skipped[39m[2m)[22m
[90mstderr[2m | tests/unit/admin-layout.test.ts[2m > [22m[2mAdmin 
Dashboard Page Server Load[2m > [22m[2mload function[2m > [22m[2mshould 
handle KV errors gracefully[22m[39m
Failed to fetch setup info from KV: Error: KV Error
    at [90mC:\Users\monag\_Projects\starspace\nabu\[39mtests\unit\admin-layou
t.test.ts:133:38
    at [90mfile:///C:/Users/monag/_Projects/starspace/nabu/[39mnode_modules/
[4m@vitest/runner[24m/dist/index.js:135:14
    at [90mfile:///C:/Users/monag/_Projects/starspace/nabu/[39mnode_modules/
[4m@vitest/runner[24m/dist/index.js:60:26
    at runTest [90m(file:///C:/Users/monag/_Projects/starspace/nabu/[39mnode_
modules/[4m@vitest/runner[24m/dist/index.js:781:17[90m)[39m
    at runSuite [90m(file:///C:/Users/monag/_Projects/starspace/nabu/[39mnode
_modules/[4m@vitest/runner[24m/dist/index.js:909:15[90m)[39m
    at runSuite [90m(file:///C:/Users/monag/_Projects/starspace/nabu/[39mnode
_modules/[4m@vitest/runner[24m/dist/index.js:909:15[90m)[39m
    at runSuite [90m(file:///C:/Users/monag/_Projects/starspace/nabu/[39mnode
_modules/[4m@vitest/runner[24m/dist/index.js:909:15[90m)[39m
    at runFiles [90m(file:///C:/Users/monag/_Projects/starspace/nabu/[39mnode
_modules/[4m@vitest/runner[24m/dist/index.js:958:5[90m)[39m
    at startTests [90m(file:///C:/Users/monag/_Projects/starspace/nabu/[39mno
de_modules/[4m@vitest/runner[24m/dist/index.js:967:3[90m)[39m
    at [90mfile:///C:/Users/monag/_Projects/starspace/nabu/[39mnode_modules/
[4mvitest[24m/dist/chunks/runtime-runBaseTests.oAvMKtQC.js:116:7

 [32mΓ£ô[39m tests/unit/admin-layout.test.ts [2m ([22m[2m7 tests[22m[2m)[22m[90m 30[2mms[22m[39m
[90mstdout[2m | tests/unit/reset-api.test.ts[2m > [22m[2mReset API[2m > [22m[2mPOST /api/reset[2m > [22m[2mshould reset configuration successfully[22m[39m
Γ£ô Deleted KV key: auth_config:github
Γ£ô Deleted KV key: github_owner_id
Γ£ô Deleted KV key: github_owner_username
Γ£ô Deleted KV key: admin_first_login_completed
Γ£ô Setup configuration reset complete

[90mstdout[2m | tests/unit/reset-api.test.ts[2m > [22m[2mReset API[2m > [22m[2mPOST /api/reset[2m > [22m[2mshould handle individual KV delete failures gracefully[22m[39m
Γ£ô Deleted KV key: auth_config:github
Γ£ô Deleted KV key: github_owner_username
Γ£ô Deleted KV key: admin_first_login_completed
Γ£ô Setup configuration reset complete

[90mstderr[2m | tests/unit/reset-api.test.ts[2m > [22m[2mReset API[2m > 
[22m[2mPOST /api/reset[2m > [22m[2mshould handle individual KV delete 
failures gracefully[22m[39m
Failed to delete KV key github_owner_id: Error: Delete failed
    at [90mC:\Users\monag\_Projects\starspace\nabu\[39mtests\unit\reset-api.t
est.ts:102:28
[90m    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)[39m
    at runTest [90m(file:///C:/Users/monag/_Projects/starspace/nabu/[39mnode_
modules/[4m@vitest/runner[24m/dist/index.js:781:11[90m)[39m
    at runSuite [90m(file:///C:/Users/monag/_Projects/starspace/nabu/[39mnode
_modules/[4m@vitest/runner[24m/dist/index.js:909:15[90m)[39m
    at runSuite [90m(file:///C:/Users/monag/_Projects/starspace/nabu/[39mnode
_modules/[4m@vitest/runner[24m/dist/index.js:909:15[90m)[39m
    at runSuite [90m(file:///C:/Users/monag/_Projects/starspace/nabu/[39mnode
_modules/[4m@vitest/runner[24m/dist/index.js:909:15[90m)[39m
    at runFiles [90m(file:///C:/Users/monag/_Projects/starspace/nabu/[39mnode
_modules/[4m@vitest/runner[24m/dist/index.js:958:5[90m)[39m
    at startTests [90m(file:///C:/Users/monag/_Projects/starspace/nabu/[39mno
de_modules/[4m@vitest/runner[24m/dist/index.js:967:3[90m)[39m
    at [90mfile:///C:/Users/monag/_Projects/starspace/nabu/[39mnode_modules/
[4mvitest[24m/dist/chunks/runtime-runBaseTests.oAvMKtQC.js:116:7
    at withEnv [90m(file:///C:/Users/monag/_Projects/starspace/nabu/[39mnode_
modules/[4mvitest[24m/dist/chunks/runtime-runBaseTests.oAvMKtQC.js:83:5[90m)
[39m

[90mstderr[2m | tests/unit/reset-api.test.ts[2m > [22m[2mReset API[2m > 
[22m[2mPOST /api/reset[2m > [22m[2mshould handle unexpected 
errors[22m[39m
Failed to reset configuration: Error: Unexpected error
    at [90mC:\Users\monag\_Projects\starspace\nabu\[39mtests\unit\reset-api.t
est.ts:126:46
[90m    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)[39m
    at runTest [90m(file:///C:/Users/monag/_Projects/starspace/nabu/[39mnode_
modules/[4m@vitest/runner[24m/dist/index.js:781:11[90m)[39m
    at runSuite [90m(file:///C:/Users/monag/_Projects/starspace/nabu/[39mnode
_modules/[4m@vitest/runner[24m/dist/index.js:909:15[90m)[39m
    at runSuite [90m(file:///C:/Users/monag/_Projects/starspace/nabu/[39mnode
_modules/[4m@vitest/runner[24m/dist/index.js:909:15[90m)[39m
    at runSuite [90m(file:///C:/Users/monag/_Projects/starspace/nabu/[39mnode
_modules/[4m@vitest/runner[24m/dist/index.js:909:15[90m)[39m
    at runFiles [90m(file:///C:/Users/monag/_Projects/starspace/nabu/[39mnode
_modules/[4m@vitest/runner[24m/dist/index.js:958:5[90m)[39m
    at startTests [90m(file:///C:/Users/monag/_Projects/starspace/nabu/[39mno
de_modules/[4m@vitest/runner[24m/dist/index.js:967:3[90m)[39m
    at [90mfile:///C:/Users/monag/_Projects/starspace/nabu/[39mnode_modules/
[4mvitest[24m/dist/chunks/runtime-runBaseTests.oAvMKtQC.js:116:7
    at withEnv [90m(file:///C:/Users/monag/_Projects/starspace/nabu/[39mnode_
modules/[4mvitest[24m/dist/chunks/runtime-runBaseTests.oAvMKtQC.js:83:5[90m)
[39m

 [32mΓ£ô[39m tests/unit/reset-api.test.ts [2m ([22m[2m6 tests[22m[2m)[22m[90m 19[2mms[22m[39m
 [32mΓ£ô[39m tests/unit/ai-keys-status-extended.test.ts [2m ([22m[2m9 tests[22m[2m)[22m[90m 3[2mms[22m[39m
 [32mΓ£ô[39m src/lib/components/Footer.test.ts [2m ([22m[2m19 tests[22m[2m)[22m[90m 93[2mms[22m[39m
 [32mΓ£ô[39m tests/unit/ai-provider-status.test.ts [2m ([22m[2m4 tests[22m[2m)[22m[90m 3[2mms[22m[39m
 [32mΓ£ô[39m tests/unit/chat-sidebar.test.ts [2m ([22m[2m10 tests[22m[2m)[22m[90m 29[2mms[22m[39m
[90mstderr[2m | tests/unit/admin-users-api-extended.test.ts[2m > 
[22m[2mAdmin Users API - Extended Branch Coverage[2m > [22m[2mGET 
/api/admin/users - Error handling[2m > [22m[2mshould return 500 when 
database is not available[22m[39m
Failed to fetch users: HttpError { status: [33m500[39m, body: { message: 
[32m'Database not available'[39m } }

[90mstderr[2m | tests/unit/admin-users-api-extended.test.ts[2m > 
[22m[2mAdmin Users API - Extended Branch Coverage[2m > [22m[2mPOST 
/api/admin/users - Error handling[2m > [22m[2mshould return 500 when 
database is not available[22m[39m
Failed to invite user: HttpError { status: [33m500[39m, body: { message: 
[32m'Database not available'[39m } }

 [32mΓ£ô[39m tests/unit/admin-users-api-extended.test.ts [2m ([22m[2m5 tests[22m[2m)[22m[90m 30[2mms[22m[39m
[90mstderr[2m | tests/unit/voice-session-extended.test.ts[2m > 
[22m[2mVoice Session API - Extended Coverage[2m > [22m[2mshould return 
503 when no OpenAI key is configured[22m[39m
Voice session error: HttpError {
  status: [33m503[39m,
  body: { message: [32m'No OpenAI API key configured'[39m }
}
Error details: [90mundefined[39m [33m503[39m

[90mstderr[2m | tests/unit/voice-session-extended.test.ts[2m > 
[22m[2mVoice Session API - Extended Coverage[2m > [22m[2mshould return 
403 when voice chat is not enabled[22m[39m
Voice session error: HttpError {
  status: [33m403[39m,
  body: { message: [32m'Voice chat is not enabled'[39m }
}
Error details: [90mundefined[39m [33m403[39m

[90mstdout[2m | tests/unit/voice-session-extended.test.ts[2m > [22m[2mVoice Session API - Extended Coverage[2m > [22m[2mshould create session with configured voice model[22m[39m
Creating realtime session with model: gpt-4o-realtime-custom
Realtime session created, token length: [33m17[39m
Token prefix: session-token-123...

[90mstdout[2m | tests/unit/voice-session-extended.test.ts[2m > [22m[2mVoice Session API - Extended Coverage[2m > [22m[2mshould use default voice model when not configured[22m[39m
Creating realtime session with model: gpt-4o-realtime-preview-2024-12-17
Realtime session created, token length: [33m17[39m
Token prefix: session-token-123...

[90mstderr[2m | tests/unit/voice-session-extended.test.ts[2m > 
[22m[2mVoice Session API - Extended Coverage[2m > [22m[2mshould re-throw 
errors with status property[22m[39m
Voice session error: { status: [33m429[39m, message: [32m'Rate 
limited'[39m }
Error details: Rate limited [33m429[39m

[90mstdout[2m | tests/unit/voice-session-extended.test.ts[2m > [22m[2mVoice Session API - Extended Coverage[2m > [22m[2mshould throw 500 for unknown errors[22m[39m
Creating realtime session with model: gpt-4o-realtime-preview-2024-12-17

 [32mΓ£ô[39m tests/unit/voice-session-extended.test.ts [2m ([22m[2m7 tests[22m[2m)[22m[90m 20[2mms[22m[39m
 [32mΓ£ô[39m tests/unit/admin-auth-keys-delete-protection.test.ts [2m ([22m[2m5 tests[22m[2m)[22m[90m 8[2mms[22m[39m
 [32mΓ£ô[39m tests/unit/theme-toggle.test.ts [2m ([22m[2m10 tests[22m[2m)[22m[90m 27[2mms[22m[39m
 [32mΓ£ô[39m tests/unit/github-oauth-init.test.ts [2m ([22m[2m6 tests[22m[2m)[22m[90m 9[2mms[22m[39m
 [32mΓ£ô[39m tests/unit/chat-models-extended.test.ts [2m ([22m[2m3 tests[22m[2m)[22m[90m 13[2mms[22m[39m
 [32mΓ£ô[39m tests/unit/cms-registry.test.ts [2m ([22m[2m11 tests[22m[2m)[22m[90m 3[2mms[22m[39m
 [32mΓ£ô[39m tests/unit/auth-login-page.test.ts [2m ([22m[2m5 tests[22m[2m)[22m[90m 11[2mms[22m[39m
 [32mΓ£ô[39m tests/unit/setup-page-server.test.ts [2m ([22m[2m6 tests[22m[2m)[22m[90m 23[2mms[22m[39m
 [32mΓ£ô[39m src/lib/stores/theme.test.ts [2m ([22m[2m8 tests[22m[2m)[22m[90m 1[2mms[22m[39m
[90mstderr[2m | tests/unit/layout-server.test.ts[2m > [22m[2mLayout 
Server Load[2m > [22m[2mload function[2m > [22m[2mshould handle fetch 
error gracefully[22m[39m
Failed to check AI provider status: Error: Network error
    at [90mC:\Users\monag\_Projects\starspace\nabu\[39mtests\unit\layout-serv
er.test.ts:70:48
    at [90mfile:///C:/Users/monag/_Projects/starspace/nabu/[39mnode_modules/
[4m@vitest/runner[24m/dist/index.js:135:14
    at [90mfile:///C:/Users/monag/_Projects/starspace/nabu/[39mnode_modules/
[4m@vitest/runner[24m/dist/index.js:60:26
    at runTest [90m(file:///C:/Users/monag/_Projects/starspace/nabu/[39mnode_
modules/[4m@vitest/runner[24m/dist/index.js:781:17[90m)[39m
    at runSuite [90m(file:///C:/Users/monag/_Projects/starspace/nabu/[39mnode
_modules/[4m@vitest/runner[24m/dist/index.js:909:15[90m)[39m
    at runSuite [90m(file:///C:/Users/monag/_Projects/starspace/nabu/[39mnode
_modules/[4m@vitest/runner[24m/dist/index.js:909:15[90m)[39m
    at runSuite [90m(file:///C:/Users/monag/_Projects/starspace/nabu/[39mnode
_modules/[4m@vitest/runner[24m/dist/index.js:909:15[90m)[39m
    at runFiles [90m(file:///C:/Users/monag/_Projects/starspace/nabu/[39mnode
_modules/[4m@vitest/runner[24m/dist/index.js:958:5[90m)[39m
    at startTests [90m(file:///C:/Users/monag/_Projects/starspace/nabu/[39mno
de_modules/[4m@vitest/runner[24m/dist/index.js:967:3[90m)[39m
    at [90mfile:///C:/Users/monag/_Projects/starspace/nabu/[39mnode_modules/
[4mvitest[24m/dist/chunks/runtime-runBaseTests.oAvMKtQC.js:116:7

 [32mΓ£ô[39m tests/unit/layout-server.test.ts [2m ([22m[2m4 tests[22m[2m)[22m[90m 17[2mms[22m[39m
 [32mΓ£ô[39m tests/unit/admin-protection.test.ts [2m ([22m[2m6 tests[22m[2m)[22m[90m 2[2mms[22m[39m
 [32mΓ£ô[39m tests/unit/reset-page.test.ts [2m ([22m[2m5 tests[22m[2m)[22m[90m 28[2mms[22m[39m
 [32mΓ£ô[39m tests/unit/discord-oauth-init-extended.test.ts [2m ([22m[2m2 tests[22m[2m)[22m[90m 10[2mms[22m[39m
 [32mΓ£ô[39m tests/unit/command-palette-store.test.ts [2m ([22m[2m8 tests[22m[2m)[22m[90m 3[2mms[22m[39m
 [32mΓ£ô[39m tests/unit/terms-page.test.ts [2m ([22m[2m9 tests[22m[2m)[22m[90m 54[2mms[22m[39m
 [32mΓ£ô[39m tests/unit/privacy-page.test.ts [2m ([22m[2m9 tests[22m[2m)[22m[90m 67[2mms[22m[39m
 [32mΓ£ô[39m src/lib/components/ChatInterface.test.ts [2m ([22m[2m6 tests[22m[2m)[22m[90m 13[2mms[22m[39m
 [2m[90mΓåô[39m[22m tests/unit/documentation-page.test.ts [2m ([22m[2m6 tests[22m [2m|[22m [33m6 skipped[39m[2m)[22m
 [32mΓ£ô[39m tests/unit/db.test.ts [2m ([22m[2m3 tests[22m[2m)[22m[90m 2[2mms[22m[39m
 [32mΓ£ô[39m src/lib/components/ThemeSwitcher.test.ts [2m ([22m[2m4 tests[22m[2m)[22m[90m 4[2mms[22m[39m
 [32mΓ£ô[39m src/lib/components/Navigation.test.ts [2m ([22m[2m1 test[22m[2m)[22m

[2m Test Files [22m [1m[32m81 passed[39m[22m[2m | [22m[33m3 skipped[39m[90m (84)[39m
[2m      Tests [22m [1m[32m1047 passed[39m[22m[2m | [22m[33m28 skipped[39m[90m (1075)[39m
[2m   Start at [22m 04:45:35
[2m   Duration [22m 33.04s[2m (transform 4.46s, setup 16.80s, collect 5.48s, tests 7.62s, environment 255ms, prepare 162ms)[22m

[34m % [39m[2mCoverage report from [22m[33mv8[39m
-------------------|---------|----------|---------|---------|-------------------
File               | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s 
-------------------|---------|----------|---------|---------|-------------------
All files          |   93.08 |    86.83 |   95.97 |   93.08 |                   
 lib/cms           |   92.11 |    97.46 |    90.9 |   92.11 |                   
  index.ts         |       0 |        0 |       0 |       0 | 1-35              
  registry.ts      |     100 |      100 |     100 |     100 |                   
  utils.ts         |     100 |    98.61 |     100 |     100 | 135               
 lib/services      |   93.82 |    77.35 |      92 |   93.82 |                   
  account-merge.ts |     100 |      100 |     100 |     100 |                   
  cms.ts           |   90.72 |    69.09 |      90 |   90.72 | ...72-574,585-587 
  openai-chat.ts   |     100 |    95.74 |     100 |     100 | 127,141           
 lib/stores        |   96.63 |    90.29 |     100 |   96.63 |                   
  chatHistory.ts   |   95.77 |     87.5 |     100 |   95.77 | ...73,78-79,92-93 
  ...andPalette.ts |     100 |      100 |     100 |     100 |                   
  theme.ts         |     100 |      100 |     100 |     100 |                   
 lib/utils         |     100 |      100 |     100 |     100 |                   
  contrast.ts      |     100 |      100 |     100 |     100 |                   
  cost.ts          |     100 |      100 |     100 |     100 |                   
  db.ts            |     100 |      100 |     100 |     100 |                   
 routes            |     100 |      100 |     100 |     100 |                   
  ...out.server.ts |     100 |      100 |     100 |     100 |                   
 .../[contentType] |       0 |        0 |       0 |       0 |                   
  +page.server.ts  |       0 |        0 |       0 |       0 | 1-56              
 ...ntType]/[slug] |       0 |        0 |       0 |       0 |                   
  +page.server.ts  |       0 |        0 |       0 |       0 | 1-61              
 routes/admin      |     100 |      100 |     100 |     100 |                   
  ...out.server.ts |     100 |      100 |     100 |     100 |                   
  +page.server.ts  |     100 |      100 |     100 |     100 |                   
 .../admin/ai-keys |     100 |      100 |     100 |     100 |                   
  +page.server.ts  |     100 |      100 |     100 |     100 |                   
 ...dmin/auth-keys |     100 |      100 |     100 |     100 |                   
  +page.server.ts  |     100 |      100 |     100 |     100 |                   
 routes/admin/cms  |     100 |      100 |     100 |     100 |                   
  +page.server.ts  |     100 |      100 |     100 |     100 |                   
 ...min/cms/[type] |     100 |    82.85 |     100 |     100 |                   
  +page.server.ts  |     100 |    82.85 |     100 |     100 | 34-35,46,48-49,59 
 ...es/admin/users |     100 |      100 |     100 |     100 |                   
  +page.server.ts  |     100 |      100 |     100 |     100 |                   
 .../admin/ai-keys |   97.97 |    94.11 |     100 |   97.97 |                   
  +server.ts       |   97.97 |    94.11 |     100 |   97.97 | 94-95             
 ...n/ai-keys/[id] |   97.26 |    92.85 |     100 |   97.26 |                   
  +server.ts       |   97.26 |    92.85 |     100 |   97.26 | 64-65,110-111     
 ...ys/[id]/toggle |   93.75 |    88.88 |     100 |   93.75 |                   
  +server.ts       |   93.75 |    88.88 |     100 |   93.75 | 45-47             
 ...ai-keys/models |   99.01 |       92 |     100 |   99.01 |                   
  +server.ts       |   99.01 |       92 |     100 |   99.01 | 301-303           
 ...ai-keys/status |     100 |      100 |     100 |     100 |                   
  +server.ts       |     100 |      100 |     100 |     100 |                   
 ...dmin/auth-keys |   95.09 |    90.47 |     100 |   95.09 |                   
  +server.ts       |   95.09 |    90.47 |     100 |   95.09 | 52-54,97-98       
 ...auth-keys/[id] |   91.91 |    89.58 |     100 |   91.91 |                   
  +server.ts       |   91.91 |    89.58 |     100 |   91.91 | ...17-120,133-135 
 ...gs/reset-route |     100 |      100 |     100 |     100 |                   
  +server.ts       |     100 |      100 |     100 |     100 |                   
 ...pi/admin/users |     100 |    96.42 |     100 |     100 |                   
  +server.ts       |     100 |    96.42 |     100 |     100 | 41                
 ...min/users/[id] |   95.48 |    88.09 |     100 |   95.48 |                   
  +server.ts       |   95.48 |    88.09 |     100 |   95.48 | ...,89-90,131-132 
 ...n/users/search |     100 |    94.11 |     100 |     100 |                   
  +server.ts       |     100 |    94.11 |     100 |     100 | 38                
 ...th/connections |     100 |    95.83 |     100 |     100 |                   
  +server.ts       |     100 |    95.83 |     100 |     100 | 75                
 ...i/auth/discord |     100 |      100 |     100 |     100 |                   
  +server.ts       |     100 |      100 |     100 |     100 |                   
 ...scord/callback |   95.82 |     89.7 |     100 |   95.82 |                   
  +server.ts       |   95.82 |     89.7 |     100 |   95.82 | ...02-303,355-358 
 ...pi/auth/github |     100 |      100 |     100 |     100 |                   
  +server.ts       |     100 |      100 |     100 |     100 |                   
 ...ithub/callback |   96.48 |    86.07 |     100 |   96.48 |                   
  +server.ts       |   96.48 |    86.07 |     100 |   96.48 | ...49-350,423-426 
 ...pi/auth/logout |     100 |      100 |     100 |     100 |                   
  +server.ts       |     100 |      100 |     100 |     100 |                   
 ...pi/chat/models |   95.91 |    84.21 |     100 |   95.91 |                   
  +server.ts       |   95.91 |    84.21 |     100 |   95.91 | 141-146           
 ...pi/chat/stream |     100 |    95.83 |     100 |     100 |                   
  +server.ts       |     100 |    95.83 |     100 |     100 | 58                
 .../voice/session |     100 |      100 |     100 |     100 |                   
  +server.ts       |     100 |      100 |     100 |     100 |                   
 ...api/cms/[type] |   82.75 |    58.06 |     100 |   82.75 |                   
  +server.ts       |   82.75 |    58.06 |     100 |   82.75 | ...07-108,113-115 
 ...ms/[type]/[id] |      72 |    26.31 |     100 |      72 |                   
  +server.ts       |      72 |    26.31 |     100 |      72 | ...81,85-86,97-99 
 ...ms/[type]/tags |   63.38 |    14.28 |     100 |   63.38 |                   
  +server.ts       |   63.38 |    14.28 |     100 |   63.38 | ...58,62-63,67-70 
 .../api/cms/types |   85.55 |    66.66 |     100 |   85.55 |                   
  +server.ts       |   85.55 |    66.66 |     100 |   85.55 | ...69,81-82,87-89 
 ...cms/types/[id] |   64.75 |    48.38 |   66.66 |   64.75 |                   
  +server.ts       |   64.75 |    48.38 |   66.66 |   64.75 | ...06-107,119-121 
 routes/api/reset  |     100 |      100 |     100 |     100 |                   
  +server.ts       |     100 |      100 |     100 |     100 |                   
 routes/api/setup  |   97.84 |    87.27 |     100 |   97.84 |                   
  +server.ts       |   97.84 |    87.27 |     100 |   97.84 | 138-139,181-182   
 routes/auth/login |     100 |      100 |     100 |     100 |                   
  +page.server.ts  |     100 |      100 |     100 |     100 |                   
 routes/chat       |   98.09 |    96.87 |     100 |   98.09 |                   
  +page.server.ts  |   98.09 |    96.87 |     100 |   98.09 | 76-77             
 routes/profile    |     100 |      100 |     100 |     100 |                   
  +page.server.ts  |     100 |      100 |     100 |     100 |                   
 routes/reset      |     100 |      100 |     100 |     100 |                   
  +page.server.ts  |     100 |      100 |     100 |     100 |                   
 routes/setup      |     100 |      100 |     100 |     100 |                   
  +page.server.ts  |     100 |      100 |     100 |     100 |                   
-------------------|---------|----------|---------|---------|-------------------
ERROR: Coverage for branches (86.83%) does not meet global threshold (90%)
close timed out after 5000ms
Tests closed successfully but something prevents Vite server from exiting
You can try to identify the cause by enabling "hanging-process" reporter. See 
https://vitest.dev/config/#reporters
